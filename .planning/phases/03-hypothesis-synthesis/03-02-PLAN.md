---
phase: 03-hypothesis-synthesis
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - commands/grd/architect.md
  - agents/grd-architect.md
autonomous: true

must_haves:
  truths:
    - "User can run /grd:architect command to synthesize hypothesis"
    - "Architect proposes hypothesis interactively with user feedback"
    - "User can provide direction or let Architect auto-propose from DATA_REPORT.md"
    - "OBJECTIVE.md is generated with all required sections populated"
  artifacts:
    - path: "commands/grd/architect.md"
      provides: "/grd:architect command entry point"
      min_lines: 80
      contains: "grd-architect"
    - path: "agents/grd-architect.md"
      provides: "grd-architect agent with conversational synthesis"
      min_lines: 200
      contains: "iterative"
  key_links:
    - from: "commands/grd/architect.md"
      to: "agents/grd-architect.md"
      via: "Task spawn"
      pattern: "subagent_type.*grd-architect"
    - from: "agents/grd-architect.md"
      to: "get-research-done/templates/objective.md"
      via: "template reference"
      pattern: "templates/objective.md"
---

<objective>
Create the /grd:architect command and grd-architect agent with conversational hypothesis synthesis workflow.

Purpose: Enable users to transform data insights into testable hypotheses through an interactive, advisor-like process. The agent should propose hypotheses, explain reasoning, and refine based on user feedback.

Output: Updated `commands/grd/architect.md` and new `agents/grd-architect.md`
</objective>

<execution_context>
@/Users/evanowen/.claude/get-shit-done/workflows/execute-plan.md
@/Users/evanowen/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-hypothesis-synthesis/03-CONTEXT.md
@.planning/phases/03-hypothesis-synthesis/03-RESEARCH.md
@.planning/phases/03-hypothesis-synthesis/03-01-SUMMARY.md

# Reference existing command/agent patterns
@commands/grd/explore.md
@agents/grd-explorer.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update /grd:architect command</name>
  <files>commands/grd/architect.md</files>
  <action>
Replace the placeholder implementation in commands/grd/architect.md with full Phase 3 implementation.

**Keep existing soft gate logic** from Phase 2 (check_data_report step) - it's already correct.

**Add new sections:**

1. **Frontmatter update:**
```yaml
---
name: grd:architect
description: Synthesize testable hypotheses from data insights with iterative refinement
allowed-tools:
  - Read
  - Bash
  - Write
  - Task
  - AskUserQuestion
---
```

2. **Objective section:**
- Synthesize testable hypotheses from DATA_REPORT.md or user direction
- Create OBJECTIVE.md with context, hypothesis, metrics, evaluation, baselines, falsification
- Support iterative refinement (Architect proposes -> user feedback -> refine)

3. **Process phases:**

**Phase 1: Setup and Context Loading**
- Keep existing check_data_report step (soft gate)
- Load PROJECT.md for project context
- If DATA_REPORT.md exists, extract key findings for hypothesis grounding

**Phase 2: Hypothesis Mode Selection**
- Check for optional `[direction]` argument
- If direction provided: Use as starting point for hypothesis
- If no direction but DATA_REPORT.md exists: Auto-propose from data insights
- If neither: Ask user what they want to test

Use AskUserQuestion:
```
header: "Hypothesis Direction"
question: "What would you like to test? (Or press Enter to auto-propose from DATA_REPORT.md)"
options: null  # Free text input
```

**Phase 3: Spawn Architect Agent**
Display banner:
```
------------------------------------------------------
 GRD > SYNTHESIZING HYPOTHESIS
------------------------------------------------------

Mode: [auto-propose | user-directed]
Data context: [DATA_REPORT.md found | No data report]
```

Spawn grd-architect agent with context:
```
Task(prompt="
<mode>
[auto-propose | user-directed]
Direction: [user_direction_if_any]
</mode>

<data_context>
@.planning/DATA_REPORT.md (if exists)

Key findings to incorporate:
- [Extracted leakage warnings]
- [Data quality issues]
- [Class balance info]
</data_context>

<project_context>
@.planning/PROJECT.md

Extract:
- Project goals
- Domain context
- Any stated research questions
</project_context>

<instructions>
Execute hypothesis synthesis workflow:

1. Propose hypothesis based on mode (auto from data OR user direction)
2. Explain reasoning and expected outcome
3. Suggest success metrics and evaluation methodology
4. Identify baseline options
5. Define falsification criteria
6. Await user feedback
7. Refine if requested, up to 15 iterations
8. When user approves, generate OBJECTIVE.md

Use template: @get-research-done/templates/objective.md
Write to: .planning/OBJECTIVE.md
</instructions>
", subagent_type="grd-architect", model="sonnet", description="Synthesize hypothesis")
```

**Phase 4: Present Results**
After agent completes, read OBJECTIVE.md and present summary:
```
------------------------------------------------------
 GRD > HYPOTHESIS SYNTHESIZED
------------------------------------------------------

## Hypothesis: [brief statement]

**Metrics:** [list with weights]
**Evaluation:** [strategy]
**Baseline:** [defined | WARNING: not defined]
**Falsification:** [criteria count] criteria defined

---

**Full objective:** `.planning/OBJECTIVE.md`

**Next steps:**
- Review OBJECTIVE.md for accuracy
- Run /grd:research to implement experiment (Phase 4)
```

4. **Arguments section:**
```
[direction] (optional)
- Text describing what you want to test
- Examples: "Does feature X improve prediction?", "Can we reduce RMSE below 0.5?"
- If omitted, Architect will auto-propose from DATA_REPORT.md findings

Flags:
--skip-data-check
- Skip the DATA_REPORT.md soft gate warning
- Use when intentionally working without data reconnaissance
```

5. **Examples section:**
```
/grd:architect
# Auto-propose from DATA_REPORT.md

/grd:architect "Can ensemble methods improve F1 over single models?"
# User-directed hypothesis

/grd:architect --skip-data-check
# Skip data gate warning
```

6. **Success criteria section:**
- [ ] DATA_REPORT.md soft gate executed (warn if missing)
- [ ] Architect agent spawned with appropriate context
- [ ] User can provide direction or receive auto-proposal
- [ ] OBJECTIVE.md generated with all required sections
- [ ] Summary presented with next steps
  </action>
  <verify>
File exists: `ls commands/grd/architect.md`
Contains process phases: `grep -c "^## Phase" commands/grd/architect.md` returns >= 3
Contains agent spawn: `grep "grd-architect" commands/grd/architect.md`
Contains arguments: `grep "direction" commands/grd/architect.md`
Does NOT contain "PLACEHOLDER": `grep -c "PLACEHOLDER" commands/grd/architect.md` returns 0
  </verify>
  <done>
/grd:architect command fully implemented with:
- Soft gate for DATA_REPORT.md (kept from Phase 2)
- Mode selection (auto-propose vs user-directed)
- Agent spawn with data and project context
- Results presentation with next steps
- Arguments for direction and --skip-data-check flag
  </done>
</task>

<task type="auto">
  <name>Task 2: Create grd-architect agent</name>
  <files>agents/grd-architect.md</files>
  <action>
Create the grd-architect agent following patterns from grd-explorer.md.

**Frontmatter:**
```yaml
---
name: grd-architect
description: Synthesizes testable hypotheses from data insights through iterative conversational refinement
tools: Read, Write, Bash, Glob, Grep, AskUserQuestion
color: purple
---
```

**Role section:**
```markdown
<role>
You are the GRD Architect agent. Your job is to help users formulate testable ML hypotheses with clear success criteria and falsification conditions.

**Core principle:** Act as a research advisor - propose, explain reasoning, accept user override. You guide hypothesis formation, not dictate it.

**You generate:** OBJECTIVE.md with:
- Context (background, motivation, data constraints)
- Hypothesis (what, why, expected outcome - prose format)
- Success metrics (weighted, with thresholds)
- Evaluation methodology (k-fold, holdout, etc.)
- Baselines (own or literature)
- Falsification criteria (what would disprove the hypothesis)

**Key behaviors:**
- Propose one hypothesis at a time, iterate based on feedback
- Ground hypotheses in DATA_REPORT.md findings when available
- Explain reasoning transparently - why this hypothesis, why these metrics
- Respect user domain expertise - they may override your suggestions
- Warn about scientific rigor issues but don't block
</role>
```

**Execution flow with 8 steps:**

**Step 1: Load Context**
- Read DATA_REPORT.md if exists (extract key findings, warnings, constraints)
- Read PROJECT.md for project goals and domain context
- Parse mode from task prompt (auto-propose or user-directed)
- Parse user direction if provided

**Step 2: Initial Proposal**
- If auto-propose mode:
  - Analyze DATA_REPORT.md findings
  - Identify promising research directions from data patterns
  - Select most compelling direction for hypothesis
- If user-directed mode:
  - Use user's direction as foundation
  - Incorporate data constraints that apply

Generate initial hypothesis proposal with:
- Hypothesis statement (what, why, expected outcome)
- Suggested metrics and weights
- Recommended evaluation methodology
- Baseline suggestions
- Initial falsification criteria
- Confidence level and rationale

**Step 3: Present Proposal to User**
Use AskUserQuestion:
```
header: "Hypothesis Proposal (Iteration {N})"
question: "
## Proposed Hypothesis

{hypothesis_statement}

### Why This Hypothesis
{rationale}

### Expected Outcome
{expected_outcome}

### Suggested Metrics
{metrics_table}

### Evaluation
{methodology}

### Baseline Options
{baseline_suggestions}

### Falsification Criteria
{falsification_criteria}

---

Feedback options:
- 'accept' - Approve this hypothesis
- 'alternative' - Propose a different hypothesis
- Any feedback - Refine based on your input
"
options: null  # Free text
```

**Step 4: Refinement Loop**
- Parse user feedback
- If "accept" or "looks good": Move to Step 6 (generation)
- If "alternative": Return to Step 2 with fresh approach
- Otherwise: Apply feedback to refine proposal
- Track iteration count (max 15)
- If max iterations: Ask user to finalize or start over

Refinement considerations:
- Adjust hypothesis scope based on feedback
- Modify metrics or weights as requested
- Change evaluation methodology if user has concerns
- Update baseline suggestions
- Tighten or loosen falsification criteria

**Step 5: Converge**
- Repeat Steps 3-4 until user accepts
- Track what changed between iterations
- Summarize final hypothesis state

**Step 6: Validate Completeness**
Before generating OBJECTIVE.md, check:
- [ ] Hypothesis has what, why, expected outcome
- [ ] At least one metric defined with weight
- [ ] Evaluation methodology specified
- [ ] Falsification criteria present
- [ ] Context section has sufficient content

If baseline not defined:
- Warn user: "No baseline defined. Cannot claim improvement without comparison."
- Suggest options: own implementation, literature citation, random/majority baseline
- Ask: "Continue without baseline? (You can add one later)"
- This is a soft gate - allow proceeding with warning

**Step 7: Generate OBJECTIVE.md**
- Read template: @get-research-done/templates/objective.md
- Populate all sections with finalized content
- Calculate metric weights sum (should be 1.0, warn if not)
- Set frontmatter values (timestamp, baseline_defined, has_falsification_criteria)
- Write to .planning/OBJECTIVE.md

**Step 8: Return Completion**
```markdown
## HYPOTHESIS SYNTHESIS COMPLETE

**Hypothesis:** [brief statement]

**Iterations:** {N}

**Key Decisions:**
- Metrics: {list}
- Evaluation: {strategy}
- Baseline: {status}
- Falsification: {criteria_count} criteria

**Output:** .planning/OBJECTIVE.md

**Validation Notes:**
- {any warnings about baseline, metrics, etc.}

**Next Phase:** Run experiments with /grd:research (Phase 4)
```

**Quality gates section:**
```markdown
<quality_gates>
Before generating OBJECTIVE.md, verify:
- [ ] Hypothesis is testable (clear expected outcome)
- [ ] Metrics are measurable (not vague)
- [ ] Evaluation methodology is appropriate for data
- [ ] Falsification criteria would actually disprove hypothesis
- [ ] Context references DATA_REPORT.md constraints (if available)
- [ ] Baseline warning issued if not defined
</quality_gates>
```

**Success criteria section:**
```markdown
<success_criteria>
- [ ] Context loaded (DATA_REPORT.md and PROJECT.md)
- [ ] Initial proposal generated (auto or from direction)
- [ ] User engaged in refinement loop
- [ ] Hypothesis accepted by user
- [ ] Completeness validation passed
- [ ] OBJECTIVE.md generated with all sections
- [ ] Baseline warning issued if applicable
- [ ] Completion message returned
</success_criteria>
```
  </action>
  <verify>
File exists: `ls agents/grd-architect.md`
Contains role section: `grep "<role>" agents/grd-architect.md`
Contains execution_flow: `grep "execution_flow" agents/grd-architect.md`
Contains all 8 steps: `grep -c "^## Step" agents/grd-architect.md` returns 8
Contains iteration logic: `grep "iteration" agents/grd-architect.md`
Contains baseline warning: `grep "baseline" agents/grd-architect.md`
  </verify>
  <done>
grd-architect agent created with:
- Role as research advisor (proposes, explains, accepts override)
- 8-step execution flow (load -> propose -> present -> refine -> converge -> validate -> generate -> complete)
- Iterative refinement loop with max 15 iterations
- Baseline soft gate with warning
- OBJECTIVE.md generation using template
- Quality gates and success criteria
  </done>
</task>

</tasks>

<verification>
- [ ] /grd:architect command updated with full implementation (no placeholders)
- [ ] grd-architect agent created with conversational synthesis workflow
- [ ] Command spawns agent with appropriate context
- [ ] Agent supports both auto-propose and user-directed modes
- [ ] Iterative refinement loop implemented
- [ ] Baseline warning (soft gate) in place
- [ ] OBJECTIVE.md generation wired to template
</verification>

<success_criteria>
User can run `/grd:architect` and engage in conversational hypothesis synthesis. Architect proposes hypotheses, explains reasoning, refines based on feedback, and generates OBJECTIVE.md with all required sections.
</success_criteria>

<output>
After completion, create `.planning/phases/03-hypothesis-synthesis/03-02-SUMMARY.md`
</output>
