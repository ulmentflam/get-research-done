---
phase: 21-gemini-cli-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - bin/install.js
  - hooks/grd-statusline.js
  - GRD-STYLE.md
  - commands/grd/design-experiment.md
  - commands/grd/settings.md
autonomous: true

must_haves:
  truths:
    - "Installer detects Gemini CLI when available"
    - "Agents install with Gemini-compatible frontmatter format"
    - "No GSD/get-shit-done branding remains in cherry-picked code"
    - "npm test passes after all cherry-picks"
  artifacts:
    - path: "bin/install.js"
      provides: "Gemini CLI detection and agent conversion"
      contains: "claudeToGeminiTools"
    - path: "bin/install.js"
      provides: "GRD branding in all paths and messages"
      contains: "get-research-done"
  key_links:
    - from: "bin/install.js"
      to: "Gemini CLI"
      via: "which gemini detection"
      pattern: "which.*gemini"
    - from: "bin/install.js"
      to: "Agent files"
      via: "convertClaudeToGeminiAgent function"
      pattern: "convertClaudeToGeminiAgent"
---

<objective>
Cherry-pick 10 commits from upstream GSD, adapt Gemini commits for GRD branding, and verify Gemini CLI integration works.

Purpose: Enable GRD to support Gemini CLI as an alternative to Claude CLI, bringing multi-LLM flexibility to researchers.
Output: Working Gemini CLI detection in installer, agents with correct frontmatter format, no GSD branding leakage.
</objective>

<execution_context>
@/Users/evanowen/.claude/get-shit-done/workflows/execute-plan.md
@/Users/evanowen/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-gsd-sync-setup---exploration/20-01-SUMMARY.md
@.planning/phases/20-gsd-sync-setup---exploration/CHERRY_PICK_DECISIONS.md
@.planning/phases/21-gemini-cli-integration/21-CONTEXT.md
@.planning/phases/21-gemini-cli-integration/21-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Cherry-pick universal improvements</name>
  <files>bin/install.js, hooks/grd-statusline.js, GRD-STYLE.md, commands/grd/design-experiment.md, commands/grd/settings.md</files>
  <action>
Cherry-pick 7 universal improvement commits from gsd-upstream in this order:

```bash
git cherry-pick 87b2cd0  # Context bar scaling fix
git cherry-pick 2347fca  # ASCII box-drawing clarification
git cherry-pick 3257139  # CONTEXT.md downstream passing
git cherry-pick 5ee22e6  # Squash merge option
git cherry-pick 197800e  # Unified branching strategy
git cherry-pick d165496  # Attribution commit setting
git cherry-pick 91aaa35  # Gemini dead code removal
```

For each commit:
- If clean cherry-pick, commit proceeds automatically
- If conflict occurs:
  1. Resolve conflicts by keeping GRD versions of paths/branding where applicable
  2. `git add <resolved-files>`
  3. `git cherry-pick --continue`

**IMPORTANT - Path Mapping:** GRD has already renamed `commands/gsd/` to `commands/grd/`. When upstream commits reference:
- `commands/gsd/plan-phase.md` -> Apply to `commands/grd/design-experiment.md` (equivalent workflow)
- `commands/gsd/settings.md` -> Apply to `commands/grd/settings.md`
- `hooks/gsd-statusline.js` -> Apply to `hooks/grd-statusline.js`
- `GSD-STYLE.md` -> Apply to `GRD-STYLE.md`

When git reports "deleted by us" conflicts for gsd-named files, the changes should be applied to the grd-named equivalents instead.

Keep individual commits (do not squash) to preserve upstream attribution.
  </action>
  <verify>
```bash
# All 7 commits should be in git log
git log --oneline -10
# Should show 7 new commits from cherry-pick

# No uncommitted changes remain
git status
# Should show "nothing to commit, working tree clean"
```
  </verify>
  <done>7 universal improvement commits cherry-picked and committed. Each commit preserves original message and Co-Authored-By attribution.</done>
</task>

<task type="auto">
  <name>Task 2: Cherry-pick Gemini core with branding adaptation</name>
  <files>bin/install.js</files>
  <action>
Cherry-pick 2 Gemini-specific commits with branding adaptation:

**Commit 1: Gemini installer support (5379832)**
```bash
git cherry-pick --no-commit 5379832
```

In the staged changes, apply these specific branding transformations using sed:

```bash
# Replace path references
sed -i '' 's/get-shit-done/get-research-done/g' bin/install.js

# Replace command prefixes
sed -i '' 's/\/gsd:/\/grd:/g' bin/install.js

# Replace camelCase variable names (gsdTools -> grdTools, gsdAgents -> grdAgents, etc.)
sed -i '' 's/gsd\([A-Z][a-zA-Z]*\)/grd\1/g' bin/install.js

# Replace standalone lowercase gsd references
sed -i '' 's/\bgsd\b/grd/g' bin/install.js
```

Then commit with attribution:
```bash
git add -A
git commit -m "feat: add Gemini support to installer

Adapted from upstream GSD (5379832):
- Updated paths: get-shit-done -> get-research-done
- Updated commands: /gsd: -> /grd:
- Added Gemini CLI detection and agent conversion

Co-Authored-By: Dryade AI <marc.parveau@dryade.ai>"
```

**Commit 2: Gemini agent loading fixes (5660b6f)**
```bash
git cherry-pick --no-commit 5660b6f
```

Apply same branding transformations:
```bash
sed -i '' 's/get-shit-done/get-research-done/g' bin/install.js
sed -i '' 's/\/gsd:/\/grd:/g' bin/install.js
sed -i '' 's/gsd\([A-Z][a-zA-Z]*\)/grd\1/g' bin/install.js
sed -i '' 's/\bgsd\b/grd/g' bin/install.js
```

Then commit:
```bash
git add -A
git commit -m "fix: Gemini CLI agent loading errors

Adapted from upstream GSD (5660b6f):
- Fixed tool name mapping for Gemini CLI
- Updated template syntax conversion
- Agent files already GRD-branded

Co-Authored-By: Cristian Uibar <cristian@tabl.social>"
```

**Conflict resolution strategy:**
- bin/install.js will have HIGH conflict likelihood
- When conflicts occur:
  1. Keep GRD branding in all user-facing text
  2. Accept Gemini-specific logic (claudeToGeminiTools, convertClaudeToGeminiAgent)
  3. Ensure all paths use `get-research-done` not `get-shit-done`
  4. Update any new `/gsd:` references to `/grd:`
  </action>
  <verify>
```bash
# Two new commits in log
git log --oneline -5
# Should show the two Gemini commits

# Verify Gemini functions exist
grep -c "claudeToGeminiTools" bin/install.js
# Should return 1 or more

grep -c "convertClaudeToGeminiAgent" bin/install.js
# Should return 1 or more

# No GSD branding in install.js
grep -ic "get-shit-done" bin/install.js
# Should return 0

grep -c "/gsd:" bin/install.js
# Should return 0
```
  </verify>
  <done>Gemini installer support and agent loading fixes cherry-picked with GRD branding. bin/install.js contains Gemini detection logic with all paths using get-research-done and /grd: commands.</done>
</task>

<task type="auto">
  <name>Task 3: Final branding sweep and verification</name>
  <files>bin/install.js, any files with remaining GSD references</files>
  <action>
**Comprehensive branding sweep:**

1. Search for any remaining GSD references in cherry-picked files:
```bash
rg -i 'gsd|get-shit-done' --files-with-matches
```

2. For each file found, apply word-boundary replacements:
```bash
# Only in files modified by cherry-picks
rg --null -l -w 'gsd' | xargs -0 sed -i '' 's/\bgsd\b/grd/g'
rg --null -l -w 'GSD' | xargs -0 sed -i '' 's/\bGSD\b/GRD/g'
rg --null -l 'get-shit-done' | xargs -0 sed -i '' 's/get-shit-done/get-research-done/g'
rg --null -l '/gsd:' | xargs -0 sed -i '' 's/\/gsd:/\/grd:/g'
```

3. Handle camelCase variable names:
```bash
rg --null -l 'gsd[A-Z]' | xargs -0 sed -i '' 's/gsd\([A-Z]\)/grd\1/g'
```

4. If any changes were made, commit them:
```bash
git add -A
git commit -m "fix: complete GRD branding sweep after cherry-picks

- Replaced remaining gsd/GSD references with grd/GRD
- Updated all get-shit-done paths to get-research-done
- Updated all /gsd: commands to /grd:

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>"
```

**Verification:**

5. Run smoke tests:
```bash
# Help shows Gemini option
node bin/install.js --help | grep -i gemini

# Test suite passes
npm test
```

6. Verify Gemini CLI detection (if Gemini available):
```bash
which gemini && echo "Gemini CLI found" || echo "Gemini CLI not found (expected on some systems)"
```

7. Final branding check - should return 0 results:
```bash
rg -i 'get-shit-done' --files-with-matches
# Expect no results (0 files)
```
  </action>
  <verify>
```bash
# No GSD/get-shit-done branding remains anywhere in repo
rg -ic 'get-shit-done'
# Should return 0 matches total

rg -ic '\bgsd\b'
# Should return 0 matches (excluding git history)

# Test suite passes
npm test
# Should exit 0

# Installer help works
node bin/install.js --help | head -20
# Should show usage info without errors
```
  </verify>
  <done>No GSD branding remains in any cherry-picked files. npm test passes. Installer help displays without errors.</done>
</task>

</tasks>

<verification>
Overall phase verification:

1. **Git history:** 9-10 new commits (7 universal + 2 Gemini + 0-1 branding sweep)
2. **Branding check:** `rg -i 'get-shit-done'` returns no results
3. **Test suite:** `npm test` passes
4. **Installer help:** `node bin/install.js --help` shows Gemini option
5. **Gemini functions:** bin/install.js contains `claudeToGeminiTools` and `convertClaudeToGeminiAgent`
</verification>

<success_criteria>
Phase 21 is complete when:

1. All 10 planned commits cherry-picked (7 as-is, 2 adapted, 0-1 branding fix)
2. bin/install.js contains Gemini CLI detection and agent conversion logic
3. No GSD/get-shit-done branding remains in cherry-picked code
4. npm test passes
5. Installer detects Gemini CLI when available
6. Agents can be converted to Gemini-compatible frontmatter format
</success_criteria>

<output>
After completion, create `.planning/phases/21-gemini-cli-integration/21-01-SUMMARY.md`
</output>
