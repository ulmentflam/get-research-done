---
phase: 02-data-reconnaissance
plan: 04
type: execute
wave: 3
depends_on: ["02-02", "02-03"]
files_modified:
  - commands/grd/architect.md
  - get-research-done/workflows/execute-phase.md
autonomous: false

must_haves:
  truths:
    - "Running /grd:architect warns if DATA_REPORT.md is missing"
    - "Warning allows user to proceed (soft gate)"
    - "REVISE_DATA routing is documented for Phase 4"
  artifacts:
    - path: "commands/grd/architect.md"
      provides: "Soft gate check for DATA_REPORT.md"
      contains: "DATA_REPORT.md"
    - path: "get-research-done/workflows/execute-phase.md"
      provides: "REVISE_DATA routing documentation"
      contains: "REVISE_DATA"
  key_links:
    - from: "commands/grd/architect.md"
      to: ".planning/DATA_REPORT.md"
      via: "file existence check"
      pattern: "DATA_REPORT.md.*missing\|warn"
---

<objective>
Integrate soft gate into /grd:architect and verify complete Explorer workflow

Purpose: This plan adds the data-first gating behavior to the Architect command (Phase 3 preparation) and includes a human verification checkpoint to test the complete Explorer workflow end-to-end.

Output: Soft gate in architect command + verified Explorer workflow
</objective>

<execution_context>
@/Users/evanowen/.claude/get-research-done/workflows/execute-plan.md
@/Users/evanowen/.claude/get-research-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-data-reconnaissance/02-CONTEXT.md
@.planning/phases/02-data-reconnaissance/02-02-SUMMARY.md
@.planning/phases/02-data-reconnaissance/02-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create /grd:architect command with soft gate</name>
  <files>commands/grd/architect.md</files>
  <action>
Create the /grd:architect command file that will be fully implemented in Phase 3, but includes the DATA_REPORT.md soft gate now.

1. **Create command file with proper frontmatter:**
   - name: grd:architect
   - description: Transforms data insights into testable hypotheses (Phase 3 command)

2. **Add soft gate check at start of execution:**
   ```markdown
   <step name="check_data_report" priority="first">
   Check for completed data reconnaissance:

   ```bash
   ls .planning/DATA_REPORT.md 2>/dev/null
   ```

   **If DATA_REPORT.md exists:**
   - Note: "Using data insights from DATA_REPORT.md"
   - Read and reference key findings for hypothesis formation

   **If DATA_REPORT.md does NOT exist:**
   - Warn: "WARNING: No DATA_REPORT.md found. Data reconnaissance not completed."
   - Suggest: "Run /grd:explore first to analyze your data before forming hypotheses."
   - Ask: "Continue anyway? (yes/no)"
   - If user says yes: Proceed without data context
   - If user says no: Exit and suggest running /grd:explore

   This is a SOFT GATE - warns but allows proceeding. User decides if data-first is needed for their workflow.
   </step>
   ```

3. **Add placeholder for Phase 3 implementation:**
   - Note that full Architect logic comes in Phase 3
   - Reference HYPO-01 through HYPO-04 requirements
   - Placeholder steps for hypothesis synthesis

4. **Add REVISE_DATA routing documentation:**
   ```markdown
   ## REVISE_DATA Routing (Phase 4)

   When the Critic agent returns `REVISE_DATA`:
   1. Route back to Explorer agent
   2. Pass Critic's feedback about data issues
   3. Explorer performs targeted re-analysis (not full re-exploration)
   4. Updated DATA_REPORT.md reflects findings
   5. Return to validation loop

   This routing is implemented in Phase 4 (LOOP-05 requirement).
   ```
  </action>
  <verify>
    - File exists at commands/grd/architect.md
    - `grep "name: grd:architect" commands/grd/architect.md` returns a match
    - `grep "DATA_REPORT.md" commands/grd/architect.md` returns multiple matches
    - `grep -i "soft gate\|warn" commands/grd/architect.md` returns a match
    - `grep "REVISE_DATA" commands/grd/architect.md` returns a match
  </verify>
  <done>
    /grd:architect command exists with soft gate and REVISE_DATA documentation
  </done>
</task>

<task type="auto">
  <name>Task 2: Document REVISE_DATA routing in execute-phase workflow</name>
  <files>get-research-done/workflows/execute-phase.md</files>
  <action>
Add documentation for REVISE_DATA routing to the execute-phase workflow.

1. **Read current execute-phase.md content**

2. **Add section for Phase 4 routing logic:**
   Add after the existing execution flow documentation:

   ```markdown
   ## Critic Exit Code Routing (Phase 4+)

   When executing phases that include the recursive validation loop (Phase 4+), the Critic agent returns exit codes that determine workflow routing:

   | Exit Code | Action | Target |
   |-----------|--------|--------|
   | PROCEED | Continue to Evaluator | Quantitative benchmarking |
   | REVISE_METHOD | Return to Researcher | With critique feedback |
   | REVISE_DATA | Return to Explorer | For targeted re-analysis |

   ### REVISE_DATA Handling

   When Critic returns REVISE_DATA:
   1. Extract data-specific concerns from Critic feedback
   2. Spawn grd-explorer agent with `--targeted` flag
   3. Pass concerns as context: "Re-examine: {concern_list}"
   4. Explorer updates DATA_REPORT.md (append or revise sections)
   5. Resume validation loop from Researcher

   ### Targeted Re-exploration

   Unlike full exploration, targeted re-analysis:
   - Only re-examines aspects flagged by Critic
   - Does not re-run all profiling/detection
   - Appends "## Targeted Re-analysis" section to DATA_REPORT.md
   - Includes timestamp and Critic reference

   This routing is wired in Phase 4 implementation.
   ```

3. **Ensure documentation is clearly marked as Phase 4 forward-reference**
  </action>
  <verify>
    - `grep "REVISE_DATA" get-research-done/workflows/execute-phase.md` returns matches
    - `grep "Critic.*exit\|exit.*code" get-research-done/workflows/execute-phase.md` returns a match
    - `grep "targeted.*re-analysis\|targeted.*re-explor" get-research-done/workflows/execute-phase.md` returns a match
  </verify>
  <done>
    execute-phase workflow documents REVISE_DATA routing for Phase 4
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Explorer workflow:
- /grd:explore command
- grd-explorer agent with data loading, profiling, and leakage detection
- DATA_REPORT.md template
- /grd:architect soft gate
- REVISE_DATA routing documentation
  </what-built>
  <how-to-verify>
1. **Verify command exists:**
   ```bash
   cat commands/grd/explore.md | head -10
   ```
   Should show name: grd:explore

2. **Verify agent has all sections:**
   ```bash
   grep -E "load_data|profile_data|detect_leakage|generate_report" agents/grd-explorer.md
   ```
   Should show all four step names

3. **Verify template structure:**
   ```bash
   grep "^## " get-research-done/templates/data-report.md
   ```
   Should show: Data Overview, Distributions, Missing Data, Outlier, Data Leakage, Recommendations

4. **Verify soft gate:**
   ```bash
   grep -A5 "DATA_REPORT.md" commands/grd/architect.md | head -10
   ```
   Should show warning and soft gate logic

5. **Test explore command invocation (optional - requires test data):**
   - If you have a test CSV file, try: `/grd:explore path/to/test.csv`
   - Verify it attempts to load and analyze data
   - Verify it generates DATA_REPORT.md (or provides clear error if dependencies missing)
  </how-to-verify>
  <resume-signal>Type "approved" if workflow is correct, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Run comprehensive verification:

```bash
echo "=== Phase 02 Complete Verification ==="

echo "1. Command files created:"
ls -la commands/grd/explore.md commands/grd/architect.md

echo "2. Agent file exists:"
ls -la agents/grd-explorer.md

echo "3. Template file exists:"
ls -la get-research-done/templates/data-report.md

echo "4. Soft gate in architect:"
grep -c "DATA_REPORT.md" commands/grd/architect.md

echo "5. REVISE_DATA in execute-phase:"
grep -c "REVISE_DATA" get-research-done/workflows/execute-phase.md

echo "6. All key patterns in explorer agent:"
echo "  - Data loading:"
grep -c "pd.read_csv\|smart_open" agents/grd-explorer.md
echo "  - Profiling:"
grep -c "zscore\|IQR\|MCAR" agents/grd-explorer.md
echo "  - Leakage:"
grep -c "correlation.*leakage\|overlap" agents/grd-explorer.md
echo "  - Report:"
grep -c "DATA_REPORT.md" agents/grd-explorer.md

echo "7. Requirements coverage:"
echo "  DATA-01 (analyze data): agents/grd-explorer.md exists"
echo "  DATA-02 (DATA_REPORT.md): template exists"
echo "  DATA-03 (leakage detection): grep shows leakage patterns"
echo "  DATA-04 (distributions): grep shows profiling patterns"
```
</verification>

<success_criteria>
- /grd:explore command launches grd-explorer agent
- grd-explorer agent can load, profile, detect leakage, and generate report
- DATA_REPORT.md template has all required sections
- /grd:architect warns (soft gate) if DATA_REPORT.md missing
- REVISE_DATA routing documented for Phase 4
- Human verifies complete workflow is functional
- Requirements DATA-01 through DATA-04 addressed
</success_criteria>

<output>
After completion, create `.planning/phases/02-data-reconnaissance/02-04-SUMMARY.md`
</output>
