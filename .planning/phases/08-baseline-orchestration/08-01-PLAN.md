---
phase: 08-baseline-orchestration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - agents/grd-researcher.md
autonomous: true

must_haves:
  truths:
    - "Researcher blocks when primary baseline missing from OBJECTIVE.md baselines"
    - "Researcher warns but proceeds when secondary baselines missing"
    - "Researcher shows actionable error with exact command to run baseline"
    - "--skip-baseline flag bypasses validation with logged warning"
  artifacts:
    - path: "agents/grd-researcher.md"
      provides: "Baseline validation gate at Step 1.0.5"
      contains: "Step 1.0.5: Validate Baseline Availability"
  key_links:
    - from: "agents/grd-researcher.md"
      to: ".planning/OBJECTIVE.md"
      via: "Baseline section parsing"
      pattern: "## Baselines"
---

<objective>
Add baseline validation gate to grd-researcher agent that checks baseline experiment results exist before main experiments can proceed.

Purpose: Enforce scientific rigor by preventing experiments without comparison baselines, following fail-fast pattern at Researcher start rather than late failure at Evaluator.

Output: Updated grd-researcher.md with Step 1.0.5 (Validate Baseline Availability) inserted between Step 1 (Load Context) and Step 2 (Create Run Directory).
</objective>

<execution_context>
@/Users/evanowen/.claude/get-research-done/workflows/execute-plan.md
@/Users/evanowen/.claude/get-research-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-baseline-orchestration/08-CONTEXT.md
@.planning/phases/08-baseline-orchestration/08-RESEARCH.md
@agents/grd-researcher.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Step 1.0.5 Baseline Validation to grd-researcher.md</name>
  <files>agents/grd-researcher.md</files>
  <action>
Insert a new step "Step 1.0.5: Validate Baseline Availability" between the existing "## Step 1: Load Context" section (after all 1.x substeps) and "## Step 2: Create Run Directory".

The new step must include:

1. **Check if baselines defined in OBJECTIVE.md:**
   - Parse the `## Baselines` table from OBJECTIVE.md
   - Extract baseline names, types, and status
   - First baseline in list is PRIMARY (required), subsequent are SECONDARY (optional)
   - If no baselines section or empty table: WARN "No baselines defined - comparison will be limited" and PROCEED

2. **Validate primary baseline exists:**
   - Look for `experiments/run_*_{baseline_name}/` or `experiments/*_{baseline_name}/` directory
   - Check if `metrics.json` exists in baseline run directory
   - If metrics.json missing or unparseable: BLOCK with error

3. **Error message format (actionable):**
```markdown
ERROR: Primary baseline required but not found

OBJECTIVE.md defines primary baseline: {baseline_name}
Expected: experiments/run_*_{baseline_name}/metrics.json

**Action required:**
Run baseline first: /grd:research --baseline {baseline_name}

Or to proceed without baseline comparison (not recommended):
/grd:research --skip-baseline
```

4. **Validate secondary baselines (warn only):**
   - For each secondary baseline (2nd+ in list)
   - Check if run directory and metrics.json exist
   - If missing: WARN but PROCEED
```markdown
WARNING: Secondary baselines missing

Missing: {baseline_list}
SCORECARD comparison will be limited to primary baseline.

To add secondary baselines, run:
/grd:research --baseline {missing_name}
```

5. **Handle --skip-baseline flag:**
   - If flag present in task prompt context, skip validation
   - Log warning to STATE.md: "Baseline validation skipped by user (--skip-baseline)"
   - Include in run README.md metadata: `baseline_validation_skipped: true`
   - Proceed without baseline checking

6. **Store validation results for later steps:**
```python
baseline_state = {
    'validated': True,
    'primary_baseline': baseline_name,
    'primary_run_path': experiments/run_XXX_baseline/,
    'secondary_baselines': [],
    'missing_secondary': [],
    'validation_skipped': False,
    'validation_warnings': []
}
```

Use bash commands for file existence checks following GRD agent patterns:
```bash
# Find baseline run directory
BASELINE_RUN=$(find experiments/ -maxdepth 1 -type d -name "*_${BASELINE_NAME}" | head -n 1)

# Check metrics.json exists
test -f "${BASELINE_RUN}/metrics.json" && echo "valid" || echo "missing"
```

Include validation state in Internal State section at top of agent file.
  </action>
  <verify>
Read agents/grd-researcher.md and verify:
1. Step 1.0.5 exists between Step 1 and Step 2
2. Contains primary baseline blocking logic
3. Contains secondary baseline warning logic
4. Contains --skip-baseline handling
5. Contains actionable error message format
  </verify>
  <done>
grd-researcher.md has baseline validation gate that blocks on missing primary baseline with actionable error message, warns on missing secondary baselines, and supports --skip-baseline override with logging.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add baseline_state to Internal State section</name>
  <files>agents/grd-researcher.md</files>
  <action>
Update the "### Internal State" section near the top of grd-researcher.md to include baseline validation state variables:

Add after the existing state variables (iteration_count, iteration_limit, etc.):

```markdown
### Baseline Validation State

Track baseline validation results:
- baseline_validated: boolean (false until Step 1.0.5 completes)
- primary_baseline: string (name of required baseline, null if none defined)
- primary_run_path: string (path to primary baseline run directory)
- secondary_baselines: list of validated secondary baseline paths
- missing_secondary: list of missing secondary baseline names
- validation_skipped: boolean (true if --skip-baseline used)
- baseline_warnings: list of warning messages for SCORECARD

Baseline state is computed once at Step 1.0.5 and reused throughout experiment lifecycle.
```

This state will be used by Step 7 (Spawn Critic) to include baseline context in critique, and passed to Evaluator for SCORECARD generation.
  </action>
  <verify>
Read agents/grd-researcher.md Internal State section and confirm baseline_state variables are documented.
  </verify>
  <done>
grd-researcher.md Internal State section includes baseline validation state tracking with all required variables.
  </done>
</task>

</tasks>

<verification>
After completing both tasks:

1. Verify Step 1.0.5 structure:
```bash
grep -A 5 "Step 1.0.5" agents/grd-researcher.md
```

2. Verify baseline_state in Internal State:
```bash
grep -A 10 "Baseline Validation State" agents/grd-researcher.md
```

3. Verify actionable error message pattern:
```bash
grep -A 3 "Action required" agents/grd-researcher.md
```
</verification>

<success_criteria>
- [ ] Step 1.0.5 exists between Step 1 and Step 2
- [ ] Primary baseline validation blocks with actionable error
- [ ] Secondary baseline validation warns but proceeds
- [ ] --skip-baseline flag handling documented
- [ ] Internal State includes baseline_state variables
- [ ] Error messages include exact command to run
</success_criteria>

<output>
After completion, create `.planning/phases/08-baseline-orchestration/08-01-SUMMARY.md`
</output>
