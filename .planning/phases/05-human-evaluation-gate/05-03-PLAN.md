---
phase: 05-human-evaluation-gate
plan: 03
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - commands/grd/evaluate.md
  - get-research-done/templates/decision-log.md
autonomous: true

must_haves:
  truths:
    - "Per-run DECISION.md is created in experiments/run_NNN/ after decision"
    - "Central decision_log.md is updated with new entry"
    - "Decision log entries include timestamp, run, decision, key metric, and reference"
    - "STATE.md is updated to reflect decision outcome"
  artifacts:
    - path: "commands/grd/evaluate.md"
      provides: "Decision logging implementation"
      contains: "DECISION.md"
    - path: "get-research-done/templates/decision-log.md"
      provides: "Template for central human evaluation decision log"
      min_lines: 25
  key_links:
    - from: "commands/grd/evaluate.md"
      to: "experiments/run_NNN/DECISION.md"
      via: "writes decision record"
      pattern: "DECISION.md"
    - from: "commands/grd/evaluate.md"
      to: "human_eval/decision_log.md"
      via: "appends to central log"
      pattern: "decision_log.md"
---

<objective>
Implement dual decision logging: per-run DECISION.md and central decision_log.md with STATE.md updates.

Purpose: Satisfy HUMAN-03 requirement for decision tracking with rationale. Create both detailed per-run records and a central chronological log for quick reference. Update STATE.md to reflect the experiment's final status.

Output: Complete decision logging flow that creates per-run records, updates central log, and maintains state consistency.
</objective>

<execution_context>
@/Users/evanowen/.claude/get-research-done/workflows/execute-plan.md
@/Users/evanowen/.claude/get-research-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-human-evaluation-gate/05-CONTEXT.md
@.planning/phases/05-human-evaluation-gate/05-RESEARCH.md
@.planning/phases/05-human-evaluation-gate/05-01-SUMMARY.md
@get-research-done/templates/decision.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create central decision_log.md template</name>
  <files>get-research-done/templates/decision-log.md</files>
  <action>
Create template for the central decision log at `human_eval/decision_log.md`.

**Template structure (from 05-CONTEXT.md and 05-RESEARCH.md):**

```markdown
# Decision Log Template

Template for `human_eval/decision_log.md` — central chronological record of all human evaluation decisions.

---

## File Template

# Human Evaluation Decision Log

This log tracks all human evaluation decisions for this research project.

| Timestamp | Run | Decision | Key Metric | Reference |
|-----------|-----|----------|------------|-----------|

---

## Usage Notes

- **Append-only:** New entries always added at the bottom (chronological order)
- **Timestamp:** YYYY-MM-DD HH:MM format (local time)
- **Run:** Run directory name (e.g., run_003_tuned)
- **Decision:** One of Seal, Iterate, Archive
- **Key Metric:** Primary metric with value (e.g., F1=0.85)
- **Reference:** Relative path to run directory

## Example Entries

| Timestamp | Run | Decision | Key Metric | Reference |
|-----------|-----|----------|------------|-----------|
| 2026-01-30 14:23 | run_003_tuned | Seal | F1=0.85 | experiments/run_003_tuned/ |
| 2026-01-29 10:15 | run_002_baseline | Iterate | F1=0.76 | experiments/run_002_baseline/ |
| 2026-01-28 16:45 | run_001_initial | Archive | F1=0.65 | experiments/archive/2026-01-28_hypothesis_v1/ |

## Navigation

- For full decision context, see DECISION.md in each run directory
- For archived runs, see ARCHIVE_REASON.md in archive directory
- Log created automatically on first /grd:evaluate decision
```

Follow 05-CONTEXT.md decision: "Log references run only, no bidirectional links"
  </action>
  <verify>
```bash
test -f get-research-done/templates/decision-log.md && grep -q "Timestamp.*Run.*Decision" get-research-done/templates/decision-log.md && grep -q "Append-only" get-research-done/templates/decision-log.md && echo "Template created"
```
  </verify>
  <done>
decision-log.md template exists with table structure (timestamp, run, decision, key metric, reference), append-only usage notes, and example entries showing all three decision types.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement decision logging in evaluate command</name>
  <files>commands/grd/evaluate.md</files>
  <action>
Replace Phase 4 placeholder in /grd:evaluate with complete decision logging implementation.

**Step 1: Create per-run DECISION.md**

After user decision is captured, generate DECISION.md in run directory:

```bash
# Write DECISION.md to run directory
cat > experiments/$RUN_NAME/DECISION.md << EOF
# Human Decision: $RUN_NAME

**Timestamp:** $(date -u +"%Y-%m-%dT%H:%M:%SZ")
**Hypothesis:** $HYPOTHESIS_BRIEF
**Decision:** $DECISION
**Rationale:** $RATIONALE

## Evidence Summary

**Critic Verdict:** $VERDICT (Confidence: $CONFIDENCE)
**Composite Score:** $COMPOSITE_SCORE (threshold: $THRESHOLD)
**Key Metric:** $KEY_METRIC=$KEY_VALUE (target: $KEY_TARGET)

## Metrics Detail

$METRICS_TABLE

## Decision Context

$CONTEXT_FOR_DECISION_TYPE
EOF
```

Use Write tool to create the file, populating from DECISION.md template.

**Step 2: Create/append to central decision_log.md**

```bash
# Ensure human_eval directory exists
mkdir -p human_eval

# Create log file if doesn't exist (use decision-log.md template header)
if [ ! -f human_eval/decision_log.md ]; then
  # Write header from template
  cat > human_eval/decision_log.md << EOF
# Human Evaluation Decision Log

This log tracks all human evaluation decisions for this research project.

| Timestamp | Run | Decision | Key Metric | Reference |
|-----------|-----|----------|------------|-----------|
EOF
fi

# Append new entry (chronological, newest at bottom)
TIMESTAMP=$(date +"%Y-%m-%d %H:%M")
echo "| $TIMESTAMP | $RUN_NAME | $DECISION | $KEY_METRIC=$KEY_VALUE | experiments/$RUN_NAME/ |" >> human_eval/decision_log.md
```

Use Write tool with append logic (read existing content, add new entry).

**Step 3: Update STATE.md**

Update research loop state based on decision:

```bash
# Update loop status based on decision
if [ "$DECISION" = "Seal" ]; then
  # Mark hypothesis as validated
  sed -i 's/\*\*Status:\*\* .*/\*\*Status:\*\* validated/' .planning/STATE.md
  sed -i 's/loop_status: .*/loop_status: sealed/' .planning/STATE.md
elif [ "$DECISION" = "Iterate" ]; then
  # Keep loop active, increment iteration
  sed -i 's/loop_status: .*/loop_status: researcher/' .planning/STATE.md
  # Iteration count already tracked
elif [ "$DECISION" = "Archive" ]; then
  # Mark hypothesis as archived
  sed -i 's/\*\*Status:\*\* .*/\*\*Status:\*\* archived/' .planning/STATE.md
  sed -i 's/loop_status: .*/loop_status: archived/' .planning/STATE.md
fi

# Add to Human Decisions table in STATE.md
RATIONALE_EXCERPT=$(echo "$RATIONALE" | head -c 50)
echo "| $(date +%Y-%m-%d) | $DECISION | $RATIONALE_EXCERPT |" >> .planning/STATE.md
```

Update STATE.md sections:
- Research Loop State > Status
- Human Decisions table (add entry)
- Loop History table (mark final verdict)

**Display confirmation:**

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
 GRD ► DECISION LOGGED
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Decision: {Seal|Iterate|Archive}

Logged to:
- experiments/{run_name}/DECISION.md
- human_eval/decision_log.md

{Next steps based on decision}
```
  </action>
  <verify>
```bash
grep -q "DECISION.md" commands/grd/evaluate.md && grep -q "decision_log.md" commands/grd/evaluate.md && grep -q "STATE.md" commands/grd/evaluate.md && grep -q "human_eval" commands/grd/evaluate.md && echo "Decision logging implemented"
```
  </verify>
  <done>
Decision logging implemented: creates per-run DECISION.md using template, creates/appends to central human_eval/decision_log.md, updates STATE.md with decision status and Human Decisions table entry.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

```bash
# Verify decision log template
test -f get-research-done/templates/decision-log.md && echo "Decision log template exists"
grep -q "Timestamp.*Run.*Decision.*Key Metric.*Reference" get-research-done/templates/decision-log.md && echo "Table structure correct"

# Verify evaluate command has logging
grep -q "experiments/.*DECISION.md" commands/grd/evaluate.md && echo "Per-run DECISION.md write present"
grep -q "human_eval/decision_log.md" commands/grd/evaluate.md && echo "Central log append present"
grep -q "STATE.md" commands/grd/evaluate.md && echo "STATE.md update present"

# Verify all three decision types update state correctly
grep -q "Seal" commands/grd/evaluate.md && grep -q "Iterate" commands/grd/evaluate.md && grep -q "Archive" commands/grd/evaluate.md && echo "All decision paths present"
```

Expected: Template exists, command implements dual logging and state updates.
</verification>

<success_criteria>
- [ ] decision-log.md template created with table structure
- [ ] /grd:evaluate creates DECISION.md in run directory
- [ ] /grd:evaluate creates/appends to human_eval/decision_log.md
- [ ] /grd:evaluate updates STATE.md Research Loop State
- [ ] /grd:evaluate adds entry to Human Decisions table
- [ ] All three decisions (Seal/Iterate/Archive) handled correctly
- [ ] Confirmation message shows what was logged
</success_criteria>

<output>
After completion, create `.planning/phases/05-human-evaluation-gate/05-03-SUMMARY.md`
</output>
