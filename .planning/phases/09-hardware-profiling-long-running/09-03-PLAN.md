---
phase: 09-hardware-profiling-long-running
plan: 03
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - agents/grd-explorer.md
  - templates/data-report.md
autonomous: true

must_haves:
  truths:
    - "Explorer agent captures hardware profile during EDA"
    - "DATA_REPORT.md includes Hardware Profile section"
    - "Hardware profile captured at Step 0/1 before data loading"
  artifacts:
    - path: "agents/grd-explorer.md"
      provides: "Updated agent with Step 0.5 Hardware Profiling"
      contains: "capture_hardware_profile"
    - path: "templates/data-report.md"
      provides: "DATA_REPORT template with Hardware Profile section"
      contains: "## Hardware Profile"
  key_links:
    - from: "agents/grd-explorer.md"
      to: "src/grd/hardware/profiler.py"
      via: "imports and calls capture_hardware_profile()"
      pattern: "capture_hardware_profile"
---

<objective>
Update the Explorer agent to capture hardware profile during EDA and add the Hardware Profile section to the DATA_REPORT.md template.

Purpose: Hardware context must be captured early in the workflow (during EDA) so it's available for duration estimation in Researcher. Storing it in DATA_REPORT.md ensures reproducibility information is preserved.

Output: Updated grd-explorer.md agent with Step 0.5 for hardware profiling, updated data-report.md template with Hardware Profile section.
</objective>

<execution_context>
@/Users/evanowen/.claude/get-shit-done/workflows/execute-plan.md
@/Users/evanowen/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-hardware-profiling-long-running/09-RESEARCH.md
@agents/grd-explorer.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add hardware profiling step to Explorer agent</name>
  <files>agents/grd-explorer.md</files>
  <action>
Update agents/grd-explorer.md to add hardware profiling as Step 0.5 (between Step 0: Detect Analysis Mode and Step 1: Load Data).

1. Add new section after Step 0 and before Step 1:

```markdown
## Step 0.5: Capture Hardware Profile

**Responsibilities:**
- Capture complete hardware context for reproducibility
- Store profile for inclusion in DATA_REPORT.md
- Enable duration estimation for Researcher

### Hardware Profile Capture

**Capture hardware context at EDA start:**

```python
from src.grd.hardware import capture_hardware_profile

def capture_and_store_hardware():
    """Capture hardware profile for reproducibility."""
    hardware_profile = capture_hardware_profile()

    # Store globally for DATA_REPORT.md generation
    global _hardware_profile
    _hardware_profile = hardware_profile

    # Log summary
    print(f"\nHardware Profile Captured:")
    print(f"  CPU: {hardware_profile['cpu']['brand']}")
    print(f"  Cores: {hardware_profile['cpu']['cores_physical']} physical, {hardware_profile['cpu']['cores_logical']} logical")
    print(f"  Memory: {hardware_profile['memory']['total_gb']:.1f} GB")

    if hardware_profile['gpu']:
        print(f"  GPU: {hardware_profile['gpu']['name']}")
        print(f"  GPU Memory: {hardware_profile['gpu']['total_memory_gb']:.1f} GB")
        print(f"  CUDA: {hardware_profile['gpu'].get('cuda_version', 'N/A')}")
    else:
        print(f"  GPU: None detected")

    return hardware_profile

hardware_profile = capture_and_store_hardware()
```

**Hardware profile is used in:**
- Step 9: Write DATA_REPORT.md (Hardware Profile section)
- Passed to Researcher for duration estimation
```

2. Update Step 9 (Write DATA_REPORT.md) to include hardware section:

Find the section that populates the template and add:

```python
# === Hardware Profile ===
if _hardware_profile:
    hardware_section = generate_hardware_section(_hardware_profile)
    report = report.replace('{{hardware_profile_section}}', hardware_section)
else:
    report = report.replace('{{hardware_profile_section}}', '*Hardware profile not captured.*')
```

Add helper function:

```python
def generate_hardware_section(profile: dict) -> str:
    """Generate Hardware Profile section for DATA_REPORT.md"""
    section = f"""### CPU
- **Model:** {profile['cpu']['brand']}
- **Architecture:** {profile['cpu']['architecture']}
- **Cores:** {profile['cpu']['cores_physical']} physical, {profile['cpu']['cores_logical']} logical
- **Frequency:** {profile['cpu']['frequency_mhz']:.0f} MHz

### Memory
- **Total:** {profile['memory']['total_gb']:.1f} GB
- **Available:** {profile['memory']['available_gb']:.1f} GB

### Disk
- **Total:** {profile['disk']['total_gb']:.1f} GB
- **Free:** {profile['disk']['free_gb']:.1f} GB

### GPU
"""
    if profile['gpu']:
        section += f"""- **Model:** {profile['gpu']['name']}
- **Memory:** {profile['gpu']['total_memory_gb']:.1f} GB
- **CUDA Version:** {profile['gpu'].get('cuda_version', 'N/A')}
- **Compute Capability:** {profile['gpu'].get('compute_capability', 'N/A')}
- **Device Count:** {profile['gpu']['device_count']}
"""
    else:
        section += "- **Status:** No GPU detected\n"

    return section
```

3. Update the agent's output_template section to reference hardware template usage.
  </action>
  <verify>
Read agents/grd-explorer.md and confirm:
1. Step 0.5: Capture Hardware Profile exists between Step 0 and Step 1
2. capture_hardware_profile() import from src.grd.hardware
3. generate_hardware_section() function defined
4. Step 9 references hardware_profile_section placeholder
  </verify>
  <done>
Explorer agent captures hardware profile at Step 0.5, stores it for DATA_REPORT.md generation, includes helper function to format hardware section.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Hardware Profile section to DATA_REPORT.md template</name>
  <files>templates/data-report.md</files>
  <action>
Create templates/data-report.md if it doesn't exist, or update it to include Hardware Profile section.

1. Check if templates/ directory exists, create if needed:
   ```bash
   mkdir -p templates
   ```

2. Create or update templates/data-report.md with Hardware Profile section.

Add after the Data Overview section and before Column Summary:

```markdown
## Hardware Profile

**Captured:** {{hardware_timestamp}}

{{hardware_profile_section}}

---
```

The {{hardware_profile_section}} placeholder will be replaced by Explorer's generate_hardware_section() function with CPU, Memory, Disk, GPU subsections.

If creating new template, include all required sections from grd-explorer.md Step 9:
- Metadata header (timestamp, dataset name, source path)
- Data Overview table
- **Hardware Profile section (NEW)**
- Column Summary table
- Numerical Distributions table
- Categorical Distributions table
- Missing Data Analysis table
- Outliers table + Top Anomalies table
- Class Balance table
- Data Leakage Analysis (feature-target, feature-feature, train-test, temporal)
- Recommendations (Must Address, Should Address, Notes)

Ensure all existing placeholders from grd-explorer.md are preserved.
  </action>
  <verify>
Run: `ls templates/ && cat templates/data-report.md | grep "## Hardware Profile"`
Confirm:
1. templates/ directory exists
2. ## Hardware Profile section exists in template
3. {{hardware_profile_section}} placeholder present
4. {{hardware_timestamp}} placeholder present
5. Section is positioned after Data Overview
  </verify>
  <done>
DATA_REPORT.md template includes Hardware Profile section with appropriate placeholders, positioned correctly in the report structure.
  </done>
</task>

</tasks>

<verification>
1. Explorer agent has Step 0.5 with capture_hardware_profile() call
2. Template has ## Hardware Profile section
3. Placeholders match between agent and template
4. Hardware section includes CPU, Memory, Disk, GPU subsections
</verification>

<success_criteria>
- [ ] Step 0.5: Capture Hardware Profile added to grd-explorer.md
- [ ] capture_hardware_profile() imported from src.grd.hardware
- [ ] generate_hardware_section() helper function defined
- [ ] templates/data-report.md includes Hardware Profile section
- [ ] {{hardware_profile_section}} placeholder in template
- [ ] Hardware section positioned after Data Overview
</success_criteria>

<output>
After completion, create `.planning/phases/09-hardware-profiling-long-running/09-03-SUMMARY.md`
</output>
