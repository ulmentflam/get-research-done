---
phase: 19-documentation-testing
plan: 02
type: execute
wave: 2
depends_on: [19-01]
files_modified:
  - tests/integration/command-chains.test.js
  - tests/reports/validation-exceptions.md
  - package.json
autonomous: true

must_haves:
  truths:
    - "All 9 renamed commands exist as files"
    - "Integration test validates command existence"
    - "Test suite passes with node --test"
  artifacts:
    - path: "tests/integration/command-chains.test.js"
      provides: "End-to-end command chain validation"
      min_lines: 50
    - path: "tests/reports/validation-exceptions.md"
      provides: "Documentation of intentional stale references"
    - path: "package.json"
      provides: "Test script configuration"
      contains: "\"test\":"
  key_links:
    - from: "tests/integration/command-chains.test.js"
      to: "commands/grd/*.md"
      via: "file existence checks"
      pattern: "existsSync.*commands/grd"
---

<objective>
Create integration test suite validating command chain existence and document any intentional exceptions.

Purpose: Ensure the complete workflow (`new-study` -> `design-experiment` -> `run-experiment` -> `validate-results` -> `complete-study`) can be executed end-to-end without broken command references (Phase 19 requirement DOC-03).
Output: Working test suite with `npm test` command and exceptions documentation.
</objective>

<execution_context>
@~/.claude/get-research-done/workflows/execute-plan.md
@~/.claude/get-research-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-documentation-testing/19-CONTEXT.md
@.planning/phases/19-documentation-testing/19-RESEARCH.md
@.planning/phases/19-documentation-testing/19-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create integration test suite</name>
  <files>
tests/integration/command-chains.test.js
  </files>
  <action>
Create integration test file using Node.js native test runner (node:test).

**Test structure:**

```javascript
import { describe, test } from 'node:test';
import assert from 'node:assert';
import { existsSync } from 'node:fs';
import { join, dirname } from 'node:path';
import { fileURLToPath } from 'node:url';

const __dirname = dirname(fileURLToPath(import.meta.url));
const projectRoot = join(__dirname, '../..');
const commandsDir = join(projectRoot, 'commands/grd');
```

**Test cases to include:**

1. **Renamed command existence tests** - Verify all 9 renamed commands exist:
   - `design-experiment.md` (was plan-phase)
   - `run-experiment.md` (was execute-phase)
   - `scope-experiment.md` (was discuss-phase)
   - `validate-results.md` (was verify-work)
   - `literature-review.md` (was research-phase)
   - `list-experiment-assumptions.md` (was list-phase-assumptions)
   - `add-experiment.md` (was add-phase)
   - `insert-experiment.md` (was insert-experiment)
   - `remove-experiment.md` (was remove-phase)

2. **Command chain routing tests** - Verify key workflow commands exist:
   - `new-study.md` (study initiation)
   - `complete-study.md` (study completion)
   - `audit-study.md` (study validation)
   - `evaluate.md` (evaluation gate)
   - `graduate.md` (notebook graduation)

3. **Old command non-existence tests** - Verify old commands don't exist (confirms rename complete):
   - `plan-phase.md` should NOT exist
   - `execute-phase.md` should NOT exist
   - `discuss-phase.md` should NOT exist
   - `verify-work.md` should NOT exist
   - `research-phase.md` should NOT exist
   - `list-phase-assumptions.md` should NOT exist
   - `add-phase.md` should NOT exist
   - `insert-phase.md` should NOT exist
   - `remove-phase.md` should NOT exist

**Implementation pattern:**
```javascript
describe('Renamed Commands Exist', () => {
  test('design-experiment.md exists (was plan-phase)', () => {
    const filePath = join(commandsDir, 'design-experiment.md');
    assert.ok(existsSync(filePath), `Expected ${filePath} to exist`);
  });
  // ... repeat for all 9 renamed commands
});

describe('Old Commands Removed', () => {
  test('plan-phase.md no longer exists', () => {
    const filePath = join(commandsDir, 'plan-phase.md');
    assert.ok(!existsSync(filePath), `Expected ${filePath} to NOT exist (should be renamed)`);
  });
  // ... repeat for all 9 old commands
});

describe('Command Chain Endpoints', () => {
  test('new-study.md exists (chain start)', () => {
    const filePath = join(commandsDir, 'new-study.md');
    assert.ok(existsSync(filePath), `Expected ${filePath} to exist`);
  });
  // ... repeat for complete-study, evaluate, graduate
});
```
  </action>
  <verify>
```bash
node --test tests/integration/command-chains.test.js
```
All tests should pass (exit code 0).
  </verify>
  <done>Integration test file exists at `tests/integration/command-chains.test.js` and all tests pass.</done>
</task>

<task type="auto">
  <name>Task 2: Add test script to package.json and document exceptions</name>
  <files>
package.json
tests/reports/validation-exceptions.md
  </files>
  <action>
**Part A: Update package.json**

Add test script to package.json scripts section:

```json
{
  "scripts": {
    "build:hooks": "node scripts/build-hooks.js",
    "prepublishOnly": "npm run build:hooks",
    "test": "node --test tests/integration/"
  }
}
```

**Part B: Create validation exceptions document**

Create `tests/reports/validation-exceptions.md` documenting any intentional stale references:

```markdown
# Validation Exceptions

This document lists intentional references to old command names that should NOT be updated.

## Overview

During the v1.2 Command Unification (Phase 19), stale command references were identified and fixed.
Some references were intentionally preserved for historical or documentation purposes.

## Exceptions List

| File | Line | Old Command | Reason |
|------|------|-------------|--------|
| CHANGELOG.md | * | various | Historical version log - intentionally preserves old names |
| .planning/** | * | various | Planning artifacts - historical context, out of scope per CONTEXT.md |

## Validation Date

Last validated: [DATE]

## How to Re-validate

Run the stale reference detection:
\`\`\`bash
rg '\b(plan-phase|execute-phase|discuss-phase|verify-work|research-phase|list-phase-assumptions|add-phase|insert-phase|remove-phase)\b' --glob '!.planning/**' --glob '!CHANGELOG.md' -l
\`\`\`

Any matches should either be fixed or added to this exceptions list with justification.
```

Include any specific exceptions identified during Plan 01 human review.
  </action>
  <verify>
```bash
# Test script works
npm test

# Exceptions file exists
test -f tests/reports/validation-exceptions.md && echo "Exceptions doc exists"
```
Both checks should pass.
  </verify>
  <done>package.json has test script, `npm test` runs successfully, and validation-exceptions.md documents any intentional stale references.</done>
</task>

</tasks>

<verification>
After completion:
1. `npm test` passes with all integration tests green
2. Test validates all 9 renamed commands exist
3. Test confirms old command names removed
4. Exceptions documented in tests/reports/validation-exceptions.md
</verification>

<success_criteria>
- `npm test` exits with code 0
- All 9 renamed command files exist and are validated
- All 9 old command files confirmed removed
- Key workflow commands (new-study, complete-study, evaluate, graduate) validated
- Exceptions documentation exists
</success_criteria>

<output>
After completion, create `.planning/phases/19-documentation-testing/19-02-SUMMARY.md`
</output>
