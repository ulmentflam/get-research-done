---
phase: 19-documentation-testing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - agents/grd-planner.md
  - agents/grd-executor.md
  - agents/grd-roadmapper.md
  - agents/grd-debugger.md
  - get-research-done/workflows/list-phase-assumptions.md
  - get-research-done/workflows/verify-work.md
  - GRD-STYLE.md
autonomous: false

must_haves:
  truths:
    - "No stale command names exist in agent prompts (outside .planning/)"
    - "No stale command names exist in workflow files (outside .planning/)"
    - "Human has reviewed all matches before fixes applied"
  artifacts:
    - path: "agents/grd-planner.md"
      provides: "GRD planner agent prompt"
      contains: "design-experiment"
    - path: "agents/grd-executor.md"
      provides: "GRD executor agent prompt"
      contains: "run-experiment"
    - path: "agents/grd-roadmapper.md"
      provides: "GRD roadmapper agent prompt"
      contains: "insert-experiment"
    - path: "agents/grd-debugger.md"
      provides: "GRD debugger agent prompt"
      contains: "design-experiment"
    - path: "get-research-done/workflows/verify-work.md"
      provides: "Verify work workflow"
      contains: "design-experiment"
    - path: "get-research-done/workflows/list-phase-assumptions.md"
      provides: "List assumptions workflow"
      contains: "scope-experiment"
    - path: "GRD-STYLE.md"
      provides: "Style guide"
      contains: "run-experiment"
  key_links:
    - from: "agents/*.md"
      to: "commands/grd/*.md"
      via: "command name references"
      pattern: "design-experiment|run-experiment|validate-results"
---

<objective>
Detect and fix stale command name references in agent prompts and workflow files.

Purpose: Ensure all GRD agents and workflows route to correct renamed commands (Phase 19 validation requirement DOC-02).
Output: Updated agent and workflow files with correct command terminology.
</objective>

<execution_context>
@~/.claude/get-research-done/workflows/execute-plan.md
@~/.claude/get-research-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-documentation-testing/19-CONTEXT.md
@.planning/phases/19-documentation-testing/19-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Generate stale reference report</name>
  <files>N/A (analysis only)</files>
  <action>
Search for all 9 old command names across files outside `.planning/` directory.

**Old command names to search:**
- `plan-phase` (replaced by `design-experiment`)
- `execute-phase` (replaced by `run-experiment`)
- `discuss-phase` (replaced by `scope-experiment`)
- `verify-work` (replaced by `validate-results`)
- `research-phase` (replaced by `literature-review`)
- `list-phase-assumptions` (replaced by `list-experiment-assumptions`)
- `add-phase` (replaced by `add-experiment`)
- `insert-phase` (replaced by `insert-experiment`)
- `remove-phase` (replaced by `remove-experiment`)

**Search scope:**
- `agents/*.md` (GRD agent prompts)
- `get-research-done/workflows/*.md` (GRD workflows)
- `GRD-STYLE.md` (style guide)
- Exclude: `.planning/**`, `CHANGELOG.md`

**For each match found:**
1. Show file path and line number
2. Show 2 lines of context before and after
3. Indicate which old command and what the replacement should be

Output a formatted report for human review.
  </action>
  <verify>Report includes all stale references with context. Expected files with matches:
- agents/grd-planner.md (plan-phase, add-phase, insert-phase)
- agents/grd-executor.md (execute-phase)
- agents/grd-roadmapper.md (insert-phase)
- agents/grd-debugger.md (plan-phase)
- get-research-done/workflows/list-phase-assumptions.md (discuss-phase)
- get-research-done/workflows/verify-work.md (plan-phase)
- GRD-STYLE.md (execute-phase)</verify>
  <done>Comprehensive report of all stale references generated with context and replacement suggestions.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Stale reference report showing all old command names found in agent prompts and workflow files</what-built>
  <how-to-verify>
1. Review each match in the report
2. Confirm each replacement is correct (old name -> new name)
3. Identify any matches that should NOT be changed (e.g., historical context, documentation about the rename)
4. Note any exceptions to record

Expected replacements:
- `plan-phase` -> `design-experiment`
- `execute-phase` -> `run-experiment`
- `discuss-phase` -> `scope-experiment`
- `verify-work` -> `validate-results`
- `research-phase` -> `literature-review`
- `list-phase-assumptions` -> `list-experiment-assumptions`
- `add-phase` -> `add-experiment`
- `insert-phase` -> `insert-experiment`
- `remove-phase` -> `remove-experiment`
  </how-to-verify>
  <resume-signal>Type "approved" to proceed with fixes, or list specific exceptions (e.g., "skip line 184 in GRD-STYLE.md")</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Apply fixes to approved matches</name>
  <files>
agents/grd-planner.md
agents/grd-executor.md
agents/grd-roadmapper.md
agents/grd-debugger.md
get-research-done/workflows/list-phase-assumptions.md
get-research-done/workflows/verify-work.md
GRD-STYLE.md
  </files>
  <action>
Apply the reviewed replacements to each file. For each file:

1. Read the current file content
2. Apply replacements using exact patterns:
   - `plan-phase` -> `design-experiment` (word boundary match)
   - `execute-phase` -> `run-experiment` (word boundary match)
   - `discuss-phase` -> `scope-experiment` (word boundary match)
   - `verify-work` -> `validate-results` (word boundary match)
   - `research-phase` -> `literature-review` (word boundary match)
   - `list-phase-assumptions` -> `list-experiment-assumptions` (word boundary match)
   - `add-phase` -> `add-experiment` (word boundary match)
   - `insert-phase` -> `insert-experiment` (word boundary match)
   - `remove-phase` -> `remove-experiment` (word boundary match)
3. Skip any lines/files marked as exceptions during human review
4. Write the updated content

**Specific expected changes:**

`agents/grd-planner.md`:
- Line 115: `suggest ... before plan-phase` -> `suggest ... before design-experiment`
- Line 1198: `created by add-phase or insert-phase` -> `created by add-experiment or insert-experiment`

`agents/grd-executor.md`:
- Line 3: `Spawned by execute-phase orchestrator` -> `Spawned by run-experiment orchestrator`

`agents/grd-roadmapper.md`:
- Line 185: `via /grd:insert-phase` -> `via /grd:insert-experiment`

`agents/grd-debugger.md`:
- Line 1179: `for plan-phase --gaps` -> `for design-experiment --gaps`

`get-research-done/workflows/list-phase-assumptions.md`:
- Line 4: `from discuss-phase` -> `from scope-experiment`

`get-research-done/workflows/verify-work.md`:
- Line 2: `into /grd:plan-phase --gaps` -> `into /grd:design-experiment --gaps`

`GRD-STYLE.md`:
- Line 167: `execute-phase.md` -> `run-experiment.md` (or mark as exception if file naming is intentional)
- Line 184: `execute-phase.md` -> `run-experiment.md` (or mark as exception if file naming is intentional)
  </action>
  <verify>
Verify no stale references remain:
```bash
rg '\b(plan-phase|execute-phase|discuss-phase|verify-work|research-phase|list-phase-assumptions|add-phase|insert-phase|remove-phase)\b' agents/ get-research-done/workflows/ GRD-STYLE.md 2>/dev/null || echo "No stale references found"
```
Expected: "No stale references found" (or only approved exceptions)
  </verify>
  <done>All approved stale references replaced with correct command names. Zero stale references remain outside documented exceptions.</done>
</task>

</tasks>

<verification>
After completion:
1. Grep for old command names returns no matches (outside .planning/ and exceptions)
2. Agent prompts reference correct command routing
3. Workflow files use correct command names
</verification>

<success_criteria>
- Zero stale command references in agents/*.md (outside .planning/)
- Zero stale command references in get-research-done/workflows/*.md
- Zero stale command references in GRD-STYLE.md (or documented exceptions)
- Human reviewed and approved all changes before application
</success_criteria>

<output>
After completion, create `.planning/phases/19-documentation-testing/19-01-SUMMARY.md`
</output>
