---
phase: 14-integration-testing-validation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/14-integration-testing-validation/VALIDATION_RESULTS.md
  - scripts/verify-revise-data-routing.sh
autonomous: false

must_haves:
  truths:
    - "REVISE_DATA routing spawns Explorer in full mode not quick mode"
    - "Mode detection regex patterns match actual task prompts"
    - "Validation results document pass/fail for each scenario"
  artifacts:
    - path: ".planning/phases/14-integration-testing-validation/VALIDATION_RESULTS.md"
      provides: "Execution log of validation scenarios"
      contains: "PASS\|FAIL"
    - path: "scripts/verify-revise-data-routing.sh"
      provides: "REVISE_DATA mode verification"
      contains: "targeted re-analysis"
  key_links:
    - from: "grd-researcher.md"
      to: "grd-explorer.md"
      via: "Task spawn with profiling_mode"
      pattern: "subagent_type.*grd-explorer"
---

<objective>
Verify REVISE_DATA routing and mode detection, then execute validation scenarios.

Purpose: Ensure the Critic's REVISE_DATA verdict spawns Explorer in full analysis mode (not quick mode), and verify mode detection regex patterns match actual task prompts from commands. Document validation results.

Output:
- REVISE_DATA routing verification script
- VALIDATION_RESULTS.md with execution log
</objective>

<execution_context>
@/Users/evanowen/.claude/get-shit-done/workflows/execute-plan.md
@/Users/evanowen/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14-integration-testing-validation/14-RESEARCH.md
@.claude/agents/grd-researcher.md
@.claude/agents/grd-explorer.md
@.claude/commands/grd/quick-explore.md
@.claude/commands/grd/insights.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create REVISE_DATA Routing Verification Script</name>
  <files>scripts/verify-revise-data-routing.sh</files>
  <action>
Create script that verifies REVISE_DATA routing uses full Explorer mode:

**scripts/verify-revise-data-routing.sh**
```bash
#!/bin/bash
# Verify REVISE_DATA routing spawns Explorer in full mode (not quick)
# Usage: ./scripts/verify-revise-data-routing.sh

echo "=== REVISE_DATA Routing Verification ==="
echo ""

RESEARCHER_FILE=".claude/agents/grd-researcher.md"
EXPLORER_FILE=".claude/agents/grd-explorer.md"

PASS=0
FAIL=0

# Check researcher file exists
if [ ! -f "$RESEARCHER_FILE" ]; then
    echo "ERROR: $RESEARCHER_FILE not found"
    exit 1
fi

# Check Explorer file exists
if [ ! -f "$EXPLORER_FILE" ]; then
    echo "ERROR: $EXPLORER_FILE not found"
    exit 1
fi

echo "=== Task Prompt Analysis ==="
echo ""

# 1. Verify REVISE_DATA spawn prompt does NOT include quick mode indicators
echo "Checking REVISE_DATA spawn prompt..."

# Extract the Task prompt section for REVISE_DATA from researcher
# Look for "Route: REVISE_DATA" section and the Task prompt within it
REVISE_DATA_SECTION=$(sed -n '/Route: REVISE_DATA/,/Route: ESCALATE\|^##/p' "$RESEARCHER_FILE" 2>/dev/null)

# Check for quick mode indicators in the spawn prompt
if echo "$REVISE_DATA_SECTION" | grep -qi "profiling_mode.*quick\|<profiling_mode>\s*quick\|quick.?explore"; then
    echo "  [FAIL] REVISE_DATA spawn prompt contains quick mode indicator"
    ((FAIL++))
else
    echo "  [PASS] REVISE_DATA spawn prompt does NOT contain quick mode indicator"
    ((PASS++))
fi

# Check for targeted re-analysis indicator
if echo "$REVISE_DATA_SECTION" | grep -qi "targeted re-analysis\|revision.*not initial"; then
    echo "  [PASS] REVISE_DATA spawn prompt mentions targeted re-analysis"
    ((PASS++))
else
    echo "  [WARN] REVISE_DATA spawn prompt may not clearly indicate revision mode"
fi

# Check the spawn uses grd-explorer subagent
if echo "$REVISE_DATA_SECTION" | grep -qi 'subagent_type.*grd-explorer\|subagent_type="grd-explorer"'; then
    echo "  [PASS] REVISE_DATA spawns grd-explorer agent"
    ((PASS++))
else
    echo "  [FAIL] REVISE_DATA may not spawn grd-explorer agent"
    ((FAIL++))
fi

echo ""
echo "=== Mode Detection Regex Validation ==="
echo ""

# 2. Verify Explorer mode detection regex patterns
echo "Checking Explorer mode detection patterns..."

# Check that quick indicators exist in explorer
if grep -q "quick_indicators\|quick mode" "$EXPLORER_FILE"; then
    echo "  [PASS] Explorer has quick mode detection"
    ((PASS++))
else
    echo "  [FAIL] Explorer missing quick mode detection"
    ((FAIL++))
fi

# Check that insights indicators exist in explorer
if grep -q "insights_indicators\|insights mode" "$EXPLORER_FILE"; then
    echo "  [PASS] Explorer has insights mode detection"
    ((PASS++))
else
    echo "  [FAIL] Explorer missing insights mode detection"
    ((FAIL++))
fi

# Check default mode is full
if grep -qi "return 'full'\|default.*full" "$EXPLORER_FILE"; then
    echo "  [PASS] Explorer defaults to full mode"
    ((PASS++))
else
    echo "  [WARN] Explorer default mode unclear"
fi

echo ""
echo "=== Command Task Prompt Pattern Matching ==="
echo ""

# 3. Verify quick-explore command uses quick mode indicator
QUICK_CMD=".claude/commands/grd/quick-explore.md"
if [ -f "$QUICK_CMD" ]; then
    if grep -q '<profiling_mode>' "$QUICK_CMD" && grep -qi 'quick' "$QUICK_CMD"; then
        echo "  [PASS] quick-explore.md has <profiling_mode> quick"
        ((PASS++))
    else
        echo "  [FAIL] quick-explore.md missing proper mode indicator"
        ((FAIL++))
    fi
else
    echo "  [SKIP] quick-explore.md not found"
fi

# 4. Verify insights command uses insights mode indicator
INSIGHTS_CMD=".claude/commands/grd/insights.md"
if [ -f "$INSIGHTS_CMD" ]; then
    if grep -q '<profiling_mode>' "$INSIGHTS_CMD" && grep -qi 'insights' "$INSIGHTS_CMD"; then
        echo "  [PASS] insights.md has <profiling_mode> insights"
        ((PASS++))
    else
        echo "  [FAIL] insights.md missing proper mode indicator"
        ((FAIL++))
    fi
else
    echo "  [SKIP] insights.md not found"
fi

echo ""
echo "=== Summary ==="
echo "Passed: $PASS"
echo "Failed: $FAIL"
echo ""

if [ $FAIL -eq 0 ]; then
    echo "VERIFICATION PASSED: REVISE_DATA routes to full Explorer mode"
    exit 0
else
    echo "VERIFICATION FAILED: $FAIL issues found"
    exit 1
fi
```

Make executable with chmod +x.
  </action>
  <verify>
    ./scripts/verify-revise-data-routing.sh runs and produces structured output
    Script exits 0 if all checks pass
  </verify>
  <done>verify-revise-data-routing.sh exists, is executable, verifies REVISE_DATA does not spawn quick mode, and verifies mode detection patterns</done>
</task>

<task type="auto">
  <name>Task 2: Run All Verification Scripts</name>
  <files>.planning/phases/14-integration-testing-validation/VALIDATION_RESULTS.md</files>
  <action>
Execute all verification scripts and capture results to VALIDATION_RESULTS.md:

1. Run audit-help-commands.sh and capture output
2. Run verify-revise-data-routing.sh and capture output
3. Create VALIDATION_RESULTS.md documenting all results

**VALIDATION_RESULTS.md structure:**
```markdown
# Validation Results

**Validated:** [date]
**Phase:** 14 - Integration Testing & Validation
**Validator:** Claude (automated scripts)

## Automated Verification Results

### Help Documentation Audit

[Output from audit-help-commands.sh]

**Result:** PASS/FAIL

### REVISE_DATA Routing Verification

[Output from verify-revise-data-routing.sh]

**Result:** PASS/FAIL

## Manual Verification Status

These scenarios require manual execution with Claude Code:

| Scenario | Status | Notes |
|----------|--------|-------|
| SC-1: Progressive Exploration Path | [ ] Not run | Requires quick-explore -> explore -> architect |
| SC-2: Insights Path | [ ] Not run | Requires insights -> architect |
| SC-3: Quick-Only Warning Path | [ ] Not run | Requires quick-explore -> architect |
| SC-4: REVISE_DATA Routing | [x] Verified | Automated script confirmed |
| SC-5: Help Documentation | [x] Verified | Automated script confirmed |

## Summary

**Automated checks:** X/Y passed
**Manual checks:** Pending user execution

## Next Steps

To complete validation:
1. Review VALIDATION_CHECKLIST.md for manual test procedures
2. Execute scenarios SC-1, SC-2, SC-3 with test data
3. Update this file with manual test results
```
  </action>
  <verify>
    cat .planning/phases/14-integration-testing-validation/VALIDATION_RESULTS.md shows results from both scripts
    Results file contains "PASS" or "FAIL" for each automated check
  </verify>
  <done>VALIDATION_RESULTS.md exists with automated verification results, manual verification status table, and clear next steps</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: User Validates Manual Scenarios</name>
  <what-built>
    Automated verification scripts and results for Phase 14 validation:
    - audit-help-commands.sh (help.md coverage)
    - verify-revise-data-routing.sh (REVISE_DATA mode)
    - VALIDATION_RESULTS.md with automated results
    - VALIDATION_CHECKLIST.md with manual test procedures (from Plan 01)
  </what-built>
  <how-to-verify>
    Review automated verification results:
    1. Open .planning/phases/14-integration-testing-validation/VALIDATION_RESULTS.md
    2. Confirm all automated checks show PASS

    If you wish to run manual validation scenarios (optional):
    1. Open VALIDATION_CHECKLIST.md
    2. Execute scenarios SC-1, SC-2, SC-3 with test data
    3. Update VALIDATION_RESULTS.md with manual results

    Minimum for approval:
    - Automated checks pass (help audit + REVISE_DATA routing)
    - Manual scenarios documented (can be run later)
  </how-to-verify>
  <resume-signal>Type "approved" if automated verification passes and you're satisfied with the validation framework. Type "issues: [description]" if problems found.</resume-signal>
</task>

</tasks>

<verification>
After completing all tasks:

1. Verify all scripts exist and are executable:
   ```bash
   ls -la scripts/*.sh
   # Should show 5 scripts (4 verify + 1 audit) with execute permissions
   ```

2. Verify VALIDATION_RESULTS.md has automated results:
   ```bash
   grep -c "PASS\|FAIL" .planning/phases/14-integration-testing-validation/VALIDATION_RESULTS.md
   # Should return multiple matches
   ```

3. Verify help audit passes:
   ```bash
   ./scripts/audit-help-commands.sh
   # Should exit 0
   ```

4. Verify REVISE_DATA routing check passes:
   ```bash
   ./scripts/verify-revise-data-routing.sh
   # Should exit 0
   ```
</verification>

<success_criteria>
- [ ] verify-revise-data-routing.sh confirms REVISE_DATA uses full mode
- [ ] All verification scripts are executable
- [ ] VALIDATION_RESULTS.md contains automated verification output
- [ ] Help documentation audit passes (all v1.1 commands, no deprecated)
- [ ] REVISE_DATA routing verification passes
- [ ] User approves validation framework at checkpoint
</success_criteria>

<output>
After completion, create `.planning/phases/14-integration-testing-validation/14-02-SUMMARY.md`
</output>
