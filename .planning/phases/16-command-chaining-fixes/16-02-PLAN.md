---
phase: 16-command-chaining-fixes
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - commands/grd/evaluate.md
  - commands/grd/run-experiment.md
  - commands/grd/validate-results.md
autonomous: true

must_haves:
  truths:
    - "evaluate Seal decision explicitly suggests graduate as next step"
    - "run-experiment accepts --gaps flag (not just --gaps-only)"
    - "validate-results suggests --gaps flag (not --gaps-only)"
    - "new-study already routes to design-experiment (verified, no change needed)"
  artifacts:
    - path: "commands/grd/evaluate.md"
      provides: "Seal -> graduate routing"
      contains: "/grd:graduate"
    - path: "commands/grd/run-experiment.md"
      provides: "Standardized --gaps flag"
      contains: "--gaps"
    - path: "commands/grd/validate-results.md"
      provides: "Standardized --gaps flag suggestion"
      contains: "--gaps"
  key_links:
    - from: "evaluate.md"
      to: "graduate.md"
      via: "Phase 6 completion summary for Seal"
      pattern: "/grd:graduate"
    - from: "validate-results.md"
      to: "run-experiment.md"
      via: "Route C fix plans"
      pattern: "/grd:run-experiment.*--gaps"
---

<objective>
Add explicit graduate route for Seal decisions and standardize --gaps flag across commands.

Purpose: When a researcher seals an experiment via evaluate, they should be guided to graduate the work. The --gaps flag should be consistent across all commands (not --gaps-only).

Output: evaluate.md with graduate routing, standardized --gaps flag in run-experiment.md and validate-results.md.
</objective>

<execution_context>
@~/.claude/get-research-done/workflows/execute-plan.md
@~/.claude/get-research-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md

Files to modify:
@commands/grd/evaluate.md
@commands/grd/run-experiment.md
@commands/grd/validate-results.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add graduate route for Seal decision in evaluate.md</name>
  <files>commands/grd/evaluate.md</files>
  <action>
  In evaluate.md, find Phase 6 completion summary for Seal (around line 983-998) and update the "Next steps" section to explicitly suggest graduate.

  Current (around line 995-998):
  ```
  **Next steps:**
  - Review final artifacts in run directory
  - Consider downstream actions (deployment, paper submission, etc.)
  ```

  Change to:
  ```
  **Next steps:**
  - `/grd:graduate` — Convert validated notebook to production script
  - Review final artifacts in run directory
  - Consider downstream actions (deployment, paper submission, etc.)
  ```

  Also update the earlier template around line 560 that shows Seal next step, change:
  ```
  - Seal: "Experiment validated. Review run directory for artifacts."
  ```
  To:
  ```
  - Seal: "Experiment validated. Next: /grd:graduate"
  ```
  </action>
  <verify>
  grep -n "graduate" commands/grd/evaluate.md
  Should return matches showing /grd:graduate suggestion for Seal decision.

  grep -A5 "If Seal:" commands/grd/evaluate.md | grep -i graduate
  Should confirm graduate appears in the Seal completion flow.
  </verify>
  <done>evaluate.md explicitly routes from Seal decision to /grd:graduate</done>
</task>

<task type="auto">
  <name>Task 2: Standardize --gaps flag in run-experiment.md</name>
  <files>commands/grd/run-experiment.md</files>
  <action>
  In run-experiment.md, change all `--gaps-only` references to `--gaps`:

  1. Line ~4 argument-hint: `"<phase-number> [--gaps-only]"` -> `"<phase-number> [--gaps]"`

  2. Line ~34 flags section: `--gaps-only` description -> `--gaps`
     Change: "`--gaps-only` — Execute only gap closure plans..."
     To: "`--gaps` — Execute only gap closure plans (plans with `gap_closure: true` in frontmatter). Use after validate-results creates fix plans. Also accepts `--gaps-only` for backward compatibility."

  3. Line ~67 in process: `If \`--gaps-only\`:` -> `If \`--gaps\`:`

  4. Keep the bash logic accepting BOTH flags for backward compatibility:
     ```bash
     # Accept both --gaps and --gaps-only for backward compatibility
     if [[ "$arg" == "--gaps-only" ]] || [[ "$arg" == "--gaps" ]]; then
     ```
  </action>
  <verify>
  grep -n "argument-hint" commands/grd/run-experiment.md | grep gaps
  Should show `--gaps` in the argument hint.

  grep -n '\\`--gaps\\`' commands/grd/run-experiment.md
  Should show the flag documentation uses --gaps as primary.
  </verify>
  <done>run-experiment.md documents --gaps as primary flag while accepting --gaps-only for backward compatibility</done>
</task>

<task type="auto">
  <name>Task 3: Update --gaps flag suggestion in validate-results.md</name>
  <files>commands/grd/validate-results.md</files>
  <action>
  In validate-results.md, find Route C (Issues found, fix plans ready) and update the --gaps-only suggestion to --gaps:

  Around line 159:
  Change: `/grd:run-experiment {Z} --gaps-only`
  To: `/grd:run-experiment {Z} --gaps`

  This is in the Route C section that shows what to run after fix plans are created.
  </action>
  <verify>
  grep -n "gaps-only" commands/grd/validate-results.md
  Should return no matches.

  grep -n "\-\-gaps" commands/grd/validate-results.md
  Should show --gaps in the Route C suggestion.
  </verify>
  <done>validate-results.md suggests --gaps flag (not --gaps-only)</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Verify evaluate routes to graduate:
   ```bash
   grep -A10 "If Seal:" commands/grd/evaluate.md | grep graduate
   ```
   Should show /grd:graduate suggestion.

2. Verify --gaps is primary flag:
   ```bash
   grep "argument-hint" commands/grd/run-experiment.md
   ```
   Should show --gaps not --gaps-only.

3. Verify --gaps-only removed from suggestions:
   ```bash
   grep "gaps-only" commands/grd/validate-results.md
   ```
   Should return no matches.

4. Verify CHAIN-01 (new-study -> design-experiment) is already correct:
   ```bash
   grep "design-experiment" commands/grd/new-study.md | head -2
   ```
   Should show new-study already routes to design-experiment.

5. Requirements covered: CHAIN-01 (verified), CHAIN-05, CHAIN-06
</verification>

<success_criteria>
- [ ] evaluate.md Seal decision explicitly suggests /grd:graduate
- [ ] run-experiment.md uses --gaps as primary flag (accepts --gaps-only for compat)
- [ ] validate-results.md suggests --gaps (not --gaps-only)
- [ ] new-study.md confirmed to route to design-experiment (already correct)
- [ ] Git commit with all modified files
</success_criteria>

<output>
After completion, create `.planning/phases/16-command-chaining-fixes/16-02-SUMMARY.md`
</output>
