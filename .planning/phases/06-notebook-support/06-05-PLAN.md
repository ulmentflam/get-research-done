---
phase: 06-notebook-support
plan: 05
type: execute
wave: 3
depends_on: ["06-03", "06-04"]
files_modified:
  - agents/grd-critic.md
autonomous: false

must_haves:
  truths:
    - "Critic evaluates notebooks and scripts with same standards"
    - "Critic validates random seeds are set for notebooks"
    - "Critic REVISE_METHOD for notebooks suggests creating new version"
    - "Phase 6 requirements verified end-to-end"
  artifacts:
    - path: "agents/grd-critic.md"
      provides: "Updated Critic with notebook evaluation parity"
      contains: "notebook"
  key_links:
    - from: "agents/grd-critic.md"
      to: "experiments/run_NNN/output.ipynb"
      via: "Reviews executed notebook"
      pattern: "output\\.ipynb"
---

<objective>
Update Critic agent for notebook evaluation parity and verify Phase 6 end-to-end.

Purpose: Ensure Critic enforces same evaluation standards for notebooks as scripts, with notebook-specific guidance for REVISE_METHOD verdicts. Verify complete notebook workflow from exploration to graduation.

Output:
- Updated `agents/grd-critic.md` with notebook-specific evaluation
- End-to-end verification of Phase 6 requirements
</objective>

<execution_context>
@/Users/evanowen/.claude/get-research-done/workflows/execute-plan.md
@/Users/evanowen/.claude/get-research-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-notebook-support/06-CONTEXT.md
@.planning/phases/06-notebook-support/06-RESEARCH.md
@.planning/phases/06-notebook-support/06-01-SUMMARY.md
@.planning/phases/06-notebook-support/06-02-SUMMARY.md
@.planning/phases/06-notebook-support/06-03-SUMMARY.md
@.planning/phases/06-notebook-support/06-04-SUMMARY.md
@agents/grd-critic.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Critic agent for notebook evaluation</name>
  <files>agents/grd-critic.md</files>
  <action>
Read and update `agents/grd-critic.md` to add notebook-specific evaluation guidance.

**Key principle from CONTEXT.md:** Same evaluation standards for notebooks and scripts (no special treatment).

**Add to Step 2: Load Experiment Artifacts**

Add notebook detection and loading:

```markdown
### 2.3 For Notebook Experiments

If run_dir contains output.ipynb:

1. **Identify as notebook run:**
   ```bash
   test -f experiments/run_{NNN}_{desc}/output.ipynb && echo "Notebook experiment"
   ```

2. **Load executed notebook:**
   Review output.ipynb for:
   - Cell execution order (should be sequential in fresh kernel)
   - Random seed setting (look for np.random.seed, torch.manual_seed, etc.)
   - Data path handling (parameterized vs hardcoded)

3. **Load extracted metrics:**
   ```bash
   cat experiments/run_{NNN}_{desc}/metrics.json
   ```
   Metrics were extracted via scrapbook from notebook outputs.

4. **Cell execution order is NOT a Critic concern:**
   Per CONTEXT.md, execution order is handled by fresh kernel per run (papermill).
   Do NOT flag sequential cell issues - they're resolved by execution engine.
```

**Add to Step 4: Apply Skepticism Checks**

Add notebook-specific reproducibility check:

```markdown
### 4.6 Notebook-Specific Checks

For notebook experiments:

1. **Random Seed Validation (HARD REQUIREMENT):**
   Check output.ipynb cells for seed setting:
   - `random.seed(`
   - `np.random.seed(`
   - `torch.manual_seed(`
   - `random_seed =` or `SEED =`

   If NO seed found: This is a HARD BLOCK for graduation.
   Recommend: "Set random seed explicitly in parameter cell for reproducibility."

2. **Parameters Cell Check:**
   Look for cell with 'parameters' tag in metadata.
   If missing: Advisory warning (papermill still injected parameters as new cell).

3. **Scrapbook Metrics Check:**
   Verify key metrics were captured via sb.glue():
   - metrics.json should have entries
   - Entries should map to OBJECTIVE.md success criteria

   If metrics missing: Warn - "Expected metrics not captured. Use scrapbook.glue() in notebook."

**Note:** Same standards as scripts. Notebooks don't get special treatment.
```

**Add to Step 5: Determine Verdict**

Add notebook-specific REVISE_METHOD guidance:

```markdown
### 5.3 Notebook-Specific Recommendations

For REVISE_METHOD verdict on notebook experiments:

**Key rule from CONTEXT.md:** Create new notebook version, don't edit in place.

Recommend:
```
For notebook iteration:
1. Copy notebooks/exploration/{notebook}.ipynb to notebooks/exploration/{notebook}_v2.ipynb
2. Make changes in the new version
3. Run /grd:research with the new notebook
4. Keep original for audit trail

Do NOT edit the original notebook in place - versioning preserves history.
```

This differs from script REVISE_METHOD where we modify train.py directly.
Notebooks preserve exploration history through explicit versioning.
```

**Update CRITIC_LOG.md template reference in Step 6:**

Add notebook fields:

```markdown
### 6.3 Notebook-Specific Fields in CRITIC_LOG.md

For notebook experiments, include:

- **Experiment Type:** notebook
- **Seed Validation:** [PASS/FAIL - random seed explicitly set]
- **Parameters Cell:** [PASS/WARN - tagged parameters cell exists]
- **Metrics Captured:** [PASS/WARN - scrapbook metrics present]

If REVISE_METHOD:
- **Versioning Guidance:** Create new notebook version (e.g., experiment_v2.ipynb)
```
  </action>
  <verify>
Check notebook handling added: `grep -c "notebook" agents/grd-critic.md`
Check seed validation: `grep "Random Seed Validation" agents/grd-critic.md`
Check versioning guidance: `grep "new notebook version" agents/grd-critic.md`
  </verify>
  <done>
- Critic loads and evaluates output.ipynb for notebook runs
- Critic validates random seed (hard requirement)
- Critic checks parameters cell (advisory)
- Critic checks scrapbook metrics capture
- REVISE_METHOD recommends creating new notebook version
- Same evaluation standards for notebooks and scripts
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify Phase 6 end-to-end</name>
  <what-built>
Complete notebook support infrastructure:
- Notebook execution module (src/grd/notebook_executor.py)
- Graduation validator module (src/grd/graduation_validator.py)
- Directory structure (notebooks/exploration/, src/experiments/)
- Graduated script template
- Updated grd-researcher for notebook experiments
- /grd:graduate command and grd-graduator agent
- Updated grd-critic for notebook evaluation
  </what-built>
  <how-to-verify>
Verify Phase 6 requirements (NOTE-01, NOTE-02, NOTE-03):

**NOTE-01: System can execute Jupyter notebooks as experiments**
1. Check notebook executor exists: `ls src/grd/notebook_executor.py`
2. Check researcher handles notebooks: `grep "experiment_type.*notebook" agents/grd-researcher.md`
3. Check execution uses papermill: `grep "pm.execute_notebook" src/grd/notebook_executor.py`

**NOTE-02: Explicit graduation path from exploratory notebooks to validated scripts**
1. Check graduate command exists: `ls commands/grd/graduate.md`
2. Check graduator agent exists: `ls agents/grd-graduator.md`
3. Check graduation validates PROCEED: `grep "PROCEED" commands/grd/graduate.md`
4. Check nbconvert conversion: `grep "nbconvert" agents/grd-graduator.md`

**NOTE-03: Clear separation between exploration/ and validated/ code**
1. Check exploration directory: `ls -la notebooks/exploration/`
2. Check experiments directory: `ls -la src/experiments/`
3. Check template references both: `grep -E "(exploration|experiments)" get-research-done/templates/graduated-script.md`

**Critic enforcement:**
1. Check same standards: `grep "Same.*standards" agents/grd-critic.md`
2. Check seed validation: `grep "Random Seed" agents/grd-critic.md`
3. Check versioning guidance: `grep "new notebook version" agents/grd-critic.md`

Review the artifacts and confirm:
- [ ] Notebook execution infrastructure complete
- [ ] Graduation workflow complete
- [ ] Directory separation established
- [ ] Critic enforces requirements
  </how-to-verify>
  <resume-signal>Type "approved" to complete Phase 6, or describe issues found</resume-signal>
</task>

</tasks>

<verification>
1. All Phase 6 artifacts exist
2. NOTE-01 satisfied: Notebooks execute via papermill
3. NOTE-02 satisfied: Graduation path with /grd:graduate
4. NOTE-03 satisfied: notebooks/exploration/ and src/experiments/ separation
5. Critic evaluates notebooks with same standards as scripts
</verification>

<success_criteria>
- grd-critic.md updated with notebook evaluation
- All Phase 6 requirements (NOTE-01, NOTE-02, NOTE-03) verified
- Human approval of end-to-end workflow
</success_criteria>

<output>
After completion, create `.planning/phases/06-notebook-support/06-05-SUMMARY.md`
</output>
